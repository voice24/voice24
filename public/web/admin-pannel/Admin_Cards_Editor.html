<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- <link href="Articles.css" rel="stylesheet" /> -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="http://fonts.cdnfonts.com/css/agency-fb?styles=17318"
      rel="stylesheet"
    />

    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Zen Maru Gothic:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Playfair Display:300,400,500,700&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.4.0/mdb.min.css"
      rel="stylesheet"
    />

    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  </head>

  <body>
    <nav class="navbar navbar-light bg-black">
      <div class="container justify-content-center">
        <a class="navbar-brand" href="https://voice24.org/index.html">
          <img src="../logo2.png" height="40" alt="MDB Logo" loading="lazy" />
        </a>
      </div>
    </nav>
    <div class="container mt-4">
      <!-- 2 column grid layout with text inputs for the first and last names -->
      <h1>Posts</h1>

      <!-- Email input -->

      <!-- Text input -->

      <select
        class="select w-100 mb-4 form-control"
        id="inlineFormSelectPref"
        placeholder="Categories"
      >
        <option value="">Select Category</option>
        <option value="Government">Government</option>
        <option value="Buisnesses">Buisnesses</option>
        <option value="Public">Public</option>
        <option value="Sports">Sports</option>
        <option value="Humanitarian">Humanitarian</option>
        <option value="Newsroom">Newsroom</option>
        <option value="Talkshow">Talkshow</option>
        <option value="Explains">Explains</option>
        <option value="Films">Films</option>
        <option value="Explore">Explore</option>
        <option value="Persuit">Persuit</option>
      </select>

      <select
        class="select w-100 mb-4 form-control"
        id="flexRadioDefault1"
        placeholder="Type"
      >
        <option value="">Select Type</option>
        <option value="Normal">Normal</option>
        <option value="Trending">Trending</option>
      </select>

      <div class="form-outline mb-4">
        <input type="text" id="form6Example19" class="form-control" />
        <label class="form-label" for="form6Example19">Alt Text</label>
      </div>

      <!-- Message input -->
      <div class="form-outline mb-5">
        <textarea class="form-control" id="form6Example9" rows="2"></textarea>
        <label class="form-label" for="form6Example9">Title </label>
        <div class="form-helper">Keep within 15 words</div>
      </div>

      <div class="form-outline mb-4">
        <textarea class="form-control" id="form6Example7" rows="8"></textarea>
        <label class="form-label" for="form6Example7">Body </label>
      </div>

      <div class="form-outline mb-4">
        <input type="text" id="form6Example3" class="form-control" />
        <label class="form-label" for="form6Example3">Hashtags</label>
      </div>

      <!-- Odisha-->
      <select id="city" name="city" class="form-control mb-4">
        <option value="">Select location</option>
        <option value="Angul">Angul</option>
        <option value="Angul District">Angul District</option>
        <option value="Asika">Asika</option>
        <option value="Athagarh">Athagarh</option>
        <option value="Bada Barabil">Bada Barabil</option>
        <option value="Balangir">Balangir</option>
        <option value="Balasore">Balasore</option>
        <option value="Baleshwar">Baleshwar</option>
        <option value="Balimila">Balimila</option>
        <option value="Balugaon">Balugaon</option>
        <option value="Banapur">Banapur</option>
        <option value="Banki">Banki</option>
        <option value="Banposh">Banposh</option>
        <option value="Baragarh">Baragarh</option>
        <option value="Barbil">Barbil</option>
        <option value="Bargarh">Bargarh</option>
        <option value="Barpali">Barpali</option>
        <option value="Basudebpur">Basudebpur</option>
        <option value="Baud">Baud</option>
        <option value="Baudh">Baudh</option>
        <option value="Belaguntha">Belaguntha</option>
        <option value="Bhadrak">Bhadrak</option>
        <option value="Bhadrakh">Bhadrakh</option>
        <option value="Bhanjanagar">Bhanjanagar</option>
        <option value="Bhawanipatna">Bhawanipatna</option>
        <option value="Bhuban">Bhuban</option>
        <option value="Bhubaneshwar">Bhubaneshwar</option>
        <option value="Binka">Binka</option>
        <option value="Birmitrapur">Birmitrapur</option>
        <option value="Bolanikhodan">Bolanikhodan</option>
        <option value="Brahmapur">Brahmapur</option>
        <option value="Brajarajnagar">Brajarajnagar</option>
        <option value="Buguda">Buguda</option>
        <option value="Burla">Burla</option>
        <option value="Champua">Champua</option>
        <option value="Chandbali">Chandbali</option>
        <option value="Chatrapur">Chatrapur</option>
        <option value="Chikitigarh">Chikitigarh</option>
        <option value="Chittarkonda">Chittarkonda</option>
        <option value="Cuttack">Cuttack</option>
        <option value="Daitari">Daitari</option>
        <option value="Deogarh">Deogarh</option>
        <option value="Dhenkanal">Dhenkanal</option>
        <option value="Digapahandi">Digapahandi</option>
        <option value="Gajapati">Gajapati</option>
        <option value="Ganjam">Ganjam</option>
        <option value="Gopalpur">Gopalpur</option>
        <option value="Gudari">Gudari</option>
        <option value="Gunupur">Gunupur</option>
        <option value="Hinjilikatu">Hinjilikatu</option>
        <option value="Hirakud">Hirakud</option>
        <option value="Jagatsinghapur">Jagatsinghapur</option>
        <option value="Jagatsinghpur">Jagatsinghpur</option>
        <option value="Jajpur">Jajpur</option>
        <option value="Jaleshwar">Jaleshwar</option>
        <option value="Jatani">Jatani</option>
        <option value="Jeypore">Jeypore</option>
        <option value="Jharsuguda">Jharsuguda</option>
        <option value="Jharsuguda District">Jharsuguda District</option>
        <option value="Kaintragarh">Kaintragarh</option>
        <option value="Kalahandi">Kalahandi</option>
        <option value="Kamakhyanagar">Kamakhyanagar</option>
        <option value="Kandhamal">Kandhamal</option>
        <option value="Kantabanji">Kantabanji</option>
        <option value="Kantilo">Kantilo</option>
        <option value="Kendrapara">Kendrapara</option>
        <option value="Kendraparha">Kendraparha</option>
        <option value="Kendujhar">Kendujhar</option>
        <option value="Kesinga">Kesinga</option>
        <option value="Khallikot">Khallikot</option>
        <option value="Kharhial">Kharhial</option>
        <option value="Khordha">Khordha</option>
        <option value="Khurda">Khurda</option>
        <option value="Kiri Buru">Kiri Buru</option>
        <option value="Kodala">Kodala</option>
        <option value="Konarka">Konarka</option>
        <option value="Koraput">Koraput</option>
        <option value="Kuchaiburi">Kuchaiburi</option>
        <option value="Kuchinda">Kuchinda</option>
        <option value="Malakanagiri">Malakanagiri</option>
        <option value="Malkangiri">Malkangiri</option>
        <option value="Mayurbhanj">Mayurbhanj</option>
        <option value="Nabarangpur">Nabarangpur</option>
        <option value="Nayagarh">Nayagarh</option>
        <option value="Nayagarh District">Nayagarh District</option>
        <option value="Nilgiri">Nilgiri</option>
        <option value="Nimaparha">Nimaparha</option>
        <option value="Nowrangapur">Nowrangapur</option>
        <option value="Nuapada">Nuapada</option>
        <option value="Padampur">Padampur</option>
        <option value="Paradip Garh">Paradip Garh</option>
        <option value="Patamundai">Patamundai</option>
        <option value="Patnagarh">Patnagarh</option>
        <option value="Phulbani">Phulbani</option>
        <option value="Pipili">Pipili</option>
        <option value="Polasara">Polasara</option>
        <option value="Puri">Puri</option>
        <option value="Purushottampur">Purushottampur</option>
        <option value="Rambha">Rambha</option>
        <option value="Raurkela">Raurkela</option>
        <option value="Rayagada">Rayagada</option>
        <option value="Remuna">Remuna</option>
        <option value="Rengali">Rengali</option>
        <option value="Sambalpur">Sambalpur</option>
        <option value="Sonepur">Sonepur</option>
        <option value="Sorada">Sorada</option>
        <option value="Soro">Soro</option>
        <option value="Subarnapur">Subarnapur</option>
        <option value="Sundargarh">Sundargarh</option>
        <option value="Talcher">Talcher</option>
        <option value="Tarabha">Tarabha</option>
        <option value="Titlagarh">Titlagarh</option>
        <option value="Udayagiri">Udayagiri</option>
      </select>
      <div class="form-outline mb-4">
        <input type="text" id="form6Example5" class="form-control" />
        <label class="form-label" for="form6Example5">subtitle</label>
      </div>
      <div class="form-outline mb-4">
        <input type="text" id="form6Example6" class="form-control" />
        <label class="form-label" for="form6Example6">YouTube Link</label>
      </div>

      <button
        type="submit"
        class="btn btn-primary btn-block mb-4"
        onclick="create_post()"
      >
        Submit
      </button>
    </div>
  </body>
  <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.4.0/mdb.min.js"
  ></script>
  <script>
    const HOST_API_URL = "http://localhost:8000";
    const POST_API_URL = `${HOST_API_URL}/api/post`;
    const BILLBOARD_API_URL = `${HOST_API_URL}/api/billboard`;
    const UPLOAD_API_URL = `${HOST_API_URL}/api/upload`;
    const STATIC_API_URL = `${HOST_API_URL}/public`;
    const AUTHOR_API_URL = `${HOST_API_URL}/api/author`;
    const ADMIN_API_URL = `${HOST_API_URL}/api/admin`;
    const getHeaders = () => {
      return {
        "Content-Type": "application/json",
        "x-access-token": localStorage.getItem("jwt"),
      };
    };
    async function create_post() {
      let postId = localStorage.getItem("postId");
      let title = document.getElementById("form6Example9").value;
      let subtitle = document.getElementById("form6Example5").value;
      let caption = document.getElementById("form6Example19").value;
      let type = document.getElementById("flexRadioDefault1").value;
      let category = document.getElementById("inlineFormSelectPref").value;
      let location = document.getElementById("city").value;
      let body = document.getElementById("form6Example7").value;
      let hashtags = document.getElementById("form6Example3").value;
      let bussinessLink = document.getElementById("form6Example6").value;
      let tagArr = prepareTags(hashtags);
      let post = {
        title: title,
        subtitle: subtitle,
        caption: caption,
        type: type,
        category: category,
        location: location,
        body: body,
        hashtags: tagArr,
        bussinessLink: bussinessLink,
      };
      let res1 = await fetch(POST_API_URL + "/" + postId, {
        method: "PUT",
        headers: getHeaders(),
        body: JSON.stringify(post),
      });
      let post_details = await res1.json();
      alert(post_details.message);
      document.location = "PostAdmin.html";
    }

    function prepareTags(tagString) {
      let tags = tagString.split(" ");
      return tags;
    }

    function ArrToStr(tags) {
      let tagStr = "";
      tags.forEach((tag) => {
        tagStr = tagStr + tag + " ";
      });
      return tagStr;
    }

    async function edit_form_ready() {
      let postId = localStorage.getItem("postId");
      let res = await fetch(POST_API_URL + "/" + postId, {
        method: "GET",
        headers: getHeaders(),
      });
      let post_details = await res.json();
      let post = post_details.content;
      let tags = ArrToStr(post?.hashtags);
      document.getElementById("form6Example9").value = post?.title;
      document.getElementById("form6Example5").value = post?.subtitle;
      document.getElementById("form6Example19").value = post?.caption;
      document.getElementById("inlineFormSelectPref").value = post?.category;
      document.getElementById("flexRadioDefault1").value = post?.type;
      document.getElementById("city").value = post?.location;
      document.getElementById("form6Example7").value = post?.body;
      document.getElementById("form6Example3").value = tags;
      document.getElementById("form6Example6").value = post?.bussinessLink;
    }
    edit_form_ready();
    async function login_check() {
      let res = await fetch(ADMIN_API_URL + "/isAdmin", {
        method: "GET",
        headers: getHeaders(),
      });
      let author = await res.json();
      let isAdmin = author?.content?.isAdmin;
      let email = localStorage.getItem("email");
      if (author?.status == "success") {
        if (isAdmin) {
          console.log("logedin successful");
        } else {
          alert("You are not autherized");
          document.location = "index.html";
        }
      } else {
        alert("Please login");
        localStorage.clear();
        document.location = "index.html";
      }
    }
    login_check();
  </script>
</html>
